<!doctype html><html><head><title>去除重复行 // 超的博客</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="去除重复行"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:locale" content="zh"><meta property="og:url" content="https://dccmmtop.github.io/posts/%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E8%A1%8C/"><link rel=icon type=image/x-icon href=../../favicon.ico><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js integrity=sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<link href=https://dccmmtop.github.io/webfonts/ptserif/main.css rel=stylesheet type=text/css><link href=https://dccmmtop.github.io/webfonts/source-code-pro/main.css rel=stylesheet type=text/css><link rel=stylesheet href=https://dccmmtop.github.io/css/style.css><link rel=stylesheet href=https://dccmmtop.github.io/css/custom.css><link rel=stylesheet href=https://dccmmtop.github.io/css/copy-to-clipboard.css><script src=https://dccmmtop.github.io/js/fastsearch.js></script>
<script src=https://dccmmtop.github.io/js/fuse.js></script>
<script src=https://dccmmtop.github.io/js/custom.js></script>
<script src=https://dccmmtop.github.io/js/copy-to-clipboard.js></script><meta name=google-site-verification content="15Pa8fZ9IfDWw5gRPmi3YLNnHcciUc4a3Hv8cNKm-Ac"><meta name=generator content="Hugo 0.111.3"></head><body><div id=container><header id=header><div id=header-outer class=outer><div id=header-inner class=inner><a id=main-nav-toggle class=nav-icon href=javascript:;></a>
<a id=logo class=logo-text href=https://dccmmtop.github.io/>超的博客</a><nav id=main-nav><a class=main-nav-link href=../../posts/>文章</a>
<a class=main-nav-link href=../../tags/>标签</a>
<a class=main-nav-link href=../../about/>我</a>
<a class=main-nav-link id=search><input id=inputSearch placeholder=search><svg t="1634282825021" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="2401" width="15" height="15"><path d="M1005.312 914.752 806.784 716.288A448 448 0 100 448a448 448 0 00716.288 358.784l198.4 198.4a64 64 0 1090.624-90.432zM448 767.936A320 320 0 11448 128a320 320 0 010 640z" fill="#262626" p-id="2402"/></svg></a></nav><nav id=sub-nav><div id=search-form-wrap></div></nav></div></div><div class="modal fade" id=exampleModal tabindex=-1 role=dialog aria-labelledby=exampleModalLabel aria-hidden=true><div class=modal-dialog role=document><div class=modal-content><div class=modal-header><h5 class=modal-title id=exampleModalLabel>搜索结果</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class="modal-body searchResults"></div></div></div></div></header><section id=main class=outer><article class="article article-type-post" itemscope itemprop=blogPost><div class=article-inner><header class=article-header><h1 class=article-title itemprop=name>去除重复行</h1></header><div class=article-meta><a href=../../posts/%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E8%A1%8C/ class=article-date><time datetime=2019-11-09T18:05:59.000+00:00 itemprop=datePublished>2019-11-09</time></a></div><div class=article-entry itemprop=articleBody><h3 id=先sort排序再去重>先sort排序，再去重</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>:sort  //直接排序
</span></span><span style=display:flex><span>:g/^<span style=color:#f1fa8c>\(</span>.*<span style=color:#f1fa8c>\)</span>$<span style=color:#f1fa8c>\n\1</span>$/d                      //去除重复行
</span></span><span style=display:flex><span>:g/<span style=color:#f1fa8c>\%</span><span style=color:#ff79c6>(</span>^<span style=color:#f1fa8c>\1</span>$<span style=color:#f1fa8c>\n\)\@</span>&lt;<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>\(</span>.*<span style=color:#f1fa8c>\)</span>$/d    //功能同上，也是去除重复行
</span></span><span style=display:flex><span>:g/<span style=color:#f1fa8c>\%</span><span style=color:#ff79c6>(</span>^<span style=color:#f1fa8c>\1\&gt;</span>.*$<span style=color:#f1fa8c>\n\)\@</span>&lt;<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>\(\k\+\)</span>.*$/d  //功能同上，也是去除重复行
</span></span></code></pre></div><h3 id=使用awk>使用awk</h3><p><code>awk '!a[$0]++' file</code></p><p>解析：</p><p>awk流程是逐行处理的，默认从文件的第一行一直处理到文件最后一行<br>还要知道awk的基本命令格式是<code>'pattern{action}'</code>先匹配各种各样的样式，然后大括号里处理如何打印输出，<br>默认的只要匹配了pattern就<code>{print $0}</code>，如果pattern未命中其判断值为假（0）那么就不会再去处理{action}了<br>pattern命中则为判断值为真（非0）就去处理{action}。<br>举个最简单的例子：<code>awk '1' file和awk '{print $0}' file</code> 是一个道理，都是从头到尾依次打印文件的每一行。</p><p><code>'!a[$0]++'</code><br>分成几个部分简单解释下吧。<br>这个命令没有{action}也就是说，只要pattern部分判断值为真（非0）就打印该行，否则就跳过不打印<br>！在awk是取相反的意思，就是把对的变成错的把真的变成假的，放在这个命令中是神马作用一会解释；<br><code>a[$0]</code> 这个非常好理解，建立数组a，其变量是文本中的每一行，awk里<code>$1</code>是第一列，<code>$2</code>是第二列，以此类推<code>$NF</code>是最后一列，而<code>$0</code>是代表所有列及分隔符，也就是一整行，这样如果pattern是真的那就打印一整行<br>++的意思是a数组取变量完毕后，对该数组值+1<br>找个最简单的文档来解释一下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat file
</span></span><span style=display:flex><span>xxx
</span></span><span style=display:flex><span>yyy
</span></span><span style=display:flex><span>xxx
</span></span><span style=display:flex><span>zzz
</span></span></code></pre></div><p>这个文件有4行，其中第一、三行是重复的。套用这个命令处理流程如下：<br>获取第一行a[xxx]，因为这是第一行，数组a里从没见过xxx这个变量，那么自然他的值就是假（0）也就是说a[xxx]=0，这个时候！就有大作用了，他把a[xxx]假（0）变成了a[xxx]为真（!0）这个时候原本不该打印的第一行就变成了应该打印了，取逻辑反后对a[xxx]的值+1然后处理第二行<br>第二行a[yyy]这个情况跟刚才第一行的a[xxx]一样，也应该打印他<br>到第三行的时候情况变了，因为第一行已经出现过a[xxx]并且已经++过了，他的值已经是非0而不是前两行的0了，本应打印但这时候再由！取逻辑反就不必打印了<br>第四行a[zzz]就又和第一、二两行一样了。<br>所以执行完就是这个结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>awk <span style=color:#f1fa8c>&#39;!a[$0]++&#39;</span> file
</span></span><span style=display:flex><span>xxx
</span></span><span style=display:flex><span>yyy
</span></span><span style=display:flex><span>zzz
</span></span></code></pre></div><p>再把file搞稍微复杂点</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>awk <span style=color:#f1fa8c>&#39;{print NR,$0}&#39;</span> file
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span> xxx
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span> yyy
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span> zzz
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> xxx
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span> yyy
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span> zzz
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span> xxx
</span></span><span style=display:flex><span><span style=color:#bd93f9>8</span> yyy
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span> zzz
</span></span></code></pre></div><p>一共9行文本，3行一次重复。为了看得更清楚，本来默认的<code>{print $0}</code>稍微改下，变成<code>{print NR,$0}</code> NR表示行号。<br>那么现在来执行下刚才讲的试试看</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>awk <span style=color:#f1fa8c>&#39;!a[$0]++{print NR,$0}&#39;</span> file
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span> xxx
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span> yyy
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span> zzz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>awk <span style=color:#f1fa8c>&#39;a[$0]++{print NR,$0}&#39;</span> file
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span> xxx
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span> yyy
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span> zzz
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span> xxx
</span></span><span style=display:flex><span><span style=color:#bd93f9>8</span> yyy
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span> zzz
</span></span></code></pre></div></div><div class=article-toc><h3></h3><nav id=TableOfContents><ul><li><ul><li><a href=#先sort排序再去重>先sort排序，再去重</a></li><li><a href=#使用awk>使用awk</a></li></ul></li></ul></nav></div><footer class=article-footer><ul class=article-tag-list><li class=article-tag-list-item><a class=article-tag-list-link href=https://dccmmtop.github.io/tags/linux>linux</a></li></ul></footer></div><nav id=article-nav><a href=../../posts/%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E8%8C%83%E5%9B%B4/ id=article-nav-newer class=article-nav-link-wrap><div class=article-nav-title><span>&lt;</span>&nbsp;
基本类型以及范围</div></a><a href=../../posts/whenever%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F/ id=article-nav-older class=article-nav-link-wrap><div class=article-nav-title>whenever使用方式&nbsp;<span>></span></div></a></nav></article></section><div><script src=https://utteranc.es/client.js repo=dccmmtop/dccmmtop.github.io issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></div><footer id=footer><div class=outer><div id=footer-info class=inner>&copy; 2023 dc<br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> with theme <a href=https://github.com/carsonip/hugo-theme-minos target=_blank>Minos</a></div></div><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin=anonymous></script>
<script>hljs.initHighlightingOnLoad()</script><script>document.getElementById("main-nav-toggle").addEventListener("click",function(){var e=document.getElementById("header");e.classList.contains("mobile-on")?e.classList.remove("mobile-on"):e.classList.add("mobile-on")})</script><style>#footer-info{line-height:1.4em;font-size:10px}.custom-blog-info{font-family:long cang,cursive;border-top:1px dashed #333;font-size:16px;margin-top:10px;padding-top:10px;line-height:1.4em}</style></footer></div></body></html>