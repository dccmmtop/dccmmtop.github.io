<!DOCTYPE html>
<html>

<head>
    <title>AOP 的使用 // 超的博客</title>

    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    

        <meta property="og:title" content="AOP 的使用" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="zh" />
    <meta property="og:url" content="https://dccmmtop.github.io/posts/aop%E7%9A%84%E4%BD%BF%E7%94%A8/" />
    

    <link rel="icon" type="image/x-icon" href="../../favicon.ico">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <link href="https://dccmmtop.github.io/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
    <link href="https://dccmmtop.github.io/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href=" https://dccmmtop.github.io/css/style.css">
    <link rel="stylesheet" href=" https://dccmmtop.github.io/css/custom.css">
    <link rel="stylesheet" href=" https://dccmmtop.github.io/css/copy-to-clipboard.css">

    <script src=" https://dccmmtop.github.io/js/fastsearch.js"></script>
    <script src=" https://dccmmtop.github.io/js/fuse.js"></script>
    <script src=" https://dccmmtop.github.io/js/custom.js"></script>
    <script src=" https://dccmmtop.github.io/js/copy-to-clipboard.js"></script>
    <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e0fe0b20745a9435509785b9f15eb32d"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script>

    <meta name="google-site-verification" content="15Pa8fZ9IfDWw5gRPmi3YLNnHcciUc4a3Hv8cNKm-Ac" />
    

    <meta name="generator" content="Hugo 0.120.4">
</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
            <a id="logo" class="logo-text" href="https://dccmmtop.github.io/">超的博客</a>
            <nav id="main-nav">
                
                <a class="main-nav-link" href="../../posts/">文章</a>
                
                <a class="main-nav-link" href="../../tags/">标签</a>
                
                <a class="main-nav-link" href="../../about/">我</a>
                
                <a class="main-nav-link" id="search" >
                  <input id="inputSearch" placeholder="search">
                  <svg t="1634282825021" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2401" width="15" height="15"><path d="M1005.312 914.752l-198.528-198.464A448 448 0 1 0 0 448a448 448 0 0 0 716.288 358.784l198.4 198.4a64 64 0 1 0 90.624-90.432zM448 767.936A320 320 0 1 1 448 128a320 320 0 0 1 0 640z" fill="#262626" p-id="2402"></path></svg></a>
            </nav>
            <nav id="sub-nav">
                <div id="search-form-wrap">
                </div>
            </nav>
        </div>
    </div>

    
    
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">搜索结果</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body searchResults">
          </div>
        </div>
      </div>
    </div>
</header>

        <section id="main" class="outer">
            <article class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            <h1 class="article-title" itemprop="name">AOP 的使用</h1>
        </header>
        
        <div class="article-meta">
            <a href="../../posts/aop%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
                <time datetime='2022-11-27T17:08:10.000&#43;00:00' itemprop="datePublished">2022-11-27</time>
            </a>
            
            
            
        </div>
        <div class="article-entry" itemprop="articleBody">
            <h3 id="声明切点poincut">声明切点@Poincut</h3>
<p>把切点声明成一个方法，便于重用</p>
<p>@Poincut 的使用格式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Poincut(<span style="color:#f1fa8c">&#34;PCD&#34;</span>) <span style="color:#6272a4">// 切点表达式 表示对哪些方法进行增强</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>(){} <span style="color:#6272a4">// 切点签名，返回值必须为 void</span>
</span></span></code></pre></div><h3 id="10-种切点表达式">10 种切点表达式</h3>
<p>AspectJ 的切点指示符 AspectJ pointcut designators (PCD) ，也就是俗称的切点表达式，Spring 中支持 10 种，如下表：</p>
<table>
<thead>
<tr>
<th>表达式类型</th>
<th>作用</th>
<th>匹配规则</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>execution</code></td>
<td>用于匹配方法执行的连接点</td>
<td></td>
</tr>
<tr>
<td><code>within</code></td>
<td>用于匹配指定类型内的方法执行</td>
<td>within(x) 匹配规则 target.getClass().equals(x)</td>
</tr>
<tr>
<td><code>this</code></td>
<td>用于匹配当前 AOP 代理对象类型的执行方法，包含引入的接口类型匹配</td>
<td>this(x) 匹配规则：x.getClass.isAssingableFrom(proxy.getClass)</td>
</tr>
<tr>
<td><code>target</code></td>
<td>用于匹配当前目标对象类型的执行方法，不包括引入接口的类型匹配</td>
<td>target(x) 匹配规则：x.getClass().isAssignableFrom(target.getClass());</td>
</tr>
<tr>
<td><code>args</code></td>
<td>用于匹配当前执行的方法传入的参数为指定类型的执行方法</td>
<td>传入的目标位置参数。getClass().equals(@args（对应的参数位置的注解类型）)!= null</td>
</tr>
<tr>
<td><code>@target</code></td>
<td>用于匹配当前目标对象类型的执行方法，其中目标对象持有指定的注解</td>
<td>target.class.getAnnotation（指定的注解类型） != null</td>
</tr>
<tr>
<td><code>@args</code></td>
<td>用于匹配当前执行的方法传入的参数持有指定注解的执行</td>
<td>传入的目标位置参数。getClass().getAnnotation(@args（对应的参数位置的注解类型）)!= null</td>
</tr>
<tr>
<td><code>@within</code></td>
<td>用于匹配所有持有指定注解类型内的方法</td>
<td>被调用的目标方法 Method 对象。getDeclaringClass().getAnnotation(within 中指定的注解类型） != null</td>
</tr>
<tr>
<td><code>@annotation</code></td>
<td>用于匹配当前执行方法持有指定注解的方法</td>
<td>target.getClass().getMethod(&ldquo;目标方法名&rdquo;).getDeclaredAnnotation(@annotation（目标注解）)!=null</td>
</tr>
<tr>
<td><code>bean</code></td>
<td>Spring AOP 扩展的，AspectJ 没有对应的指示符，用于匹配特定名称的 Bean 对象的执行方法</td>
<td>ApplicationContext.getBean(&ldquo;bean 表达式中指定的 bean 名称&rdquo;) != null</td>
</tr>
</tbody>
</table>
<p>简单介绍下 AspectJ 中常用的 3 个通配符：</p>
<ul>
<li><code>*</code>：匹配任何数量字符</li>
<li><code>..</code>：匹配任何数量字符的重复，如任何数量子包，任何数量方法参数</li>
<li><code>+</code>：匹配指定类型及其子类型，仅作为后缀防过载类型模式后面。</li>
</ul>
<h4 id="execution">execution</h4>
<p>用于匹配方法执行，最常用。</p>
<h5 id="格式说明">格式说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>   execution(modifiers<span style="color:#ff79c6">-</span>pattern<span style="color:#ff79c6">?</span> ret<span style="color:#ff79c6">-</span>type<span style="color:#ff79c6">-</span>pattern declaring<span style="color:#ff79c6">-</span>type<span style="color:#ff79c6">-</span>pattern<span style="color:#ff79c6">?</span>name<span style="color:#ff79c6">-</span>pattern(param<span style="color:#ff79c6">-</span>pattern)
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd;font-style:italic">throws</span><span style="color:#ff79c6">-</span>pattern<span style="color:#ff79c6">?</span>)
</span></span></code></pre></div><ul>
<li>其中带 <code>?</code>号的 <code>modifiers-pattern?</code>，<code>declaring-type-pattern?</code>，<code>throws-pattern?</code>是可选项</li>
<li><code>ret-type-pattern</code>,<code>name-pattern</code>, <code>parameters-pattern</code>是必选项</li>
<li><code>modifier-pattern?</code> 修饰符匹配，如 public 表示匹配公有方法，<code>*</code>表示任意修饰符</li>
<li><code>ret-type-pattern</code> 返回值匹配，<code>*</code> 表示任何返回值，全路径的类名等</li>
<li><code>declaring-type-pattern?</code> 类路径匹配</li>
<li><code>name-pattern</code> 方法名匹配，<code>*</code> 代表所有，<code>xx*</code>代表以 xx 开头的所有方法</li>
<li><code>(param-pattern)</code> 参数匹配，指定方法参数（声明的类型），<code>(..)</code>代表所有参数，<code>(*,String)</code>代表第一个参数为任何值，第二个为 String 类型，<code>(..,String)</code>代表最后一个参数是 String 类型</li>
<li><code>throws-pattern?</code> 异常类型匹配</li>
</ul>
<h5 id="举例说明">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutExecution</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// com.crab.spring.aop.demo02 包下任何类的任意方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop.demo02.*.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m1</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// com.crab.spring.aop.demo02 包及其子包下任何类的任意方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop.demo02..*.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m2</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// com.crab.spring.aop 包及其子包下 IService 接口的任意无参方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop..IService.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m3</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// com.crab.spring.aop 包及其子包下 IService 接口及其子类型的任意无参方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop..IService+.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m4</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// com.crab.spring.aop.demo02.UserService 类中有且只有一个 String 参数的方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop.demo02.UserService.*(String))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m5</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// com.crab.spring.aop.demo02.UserService 类中参数个数为 2 且最后一个参数类型是 String 的方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop.demo02.UserService.*(*,String))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m6</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// com.crab.spring.aop.demo02.UserService 类中最后一个参数类型是 String 的方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop.demo02.UserService.*(..,String))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m7</span>(){}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="within">within</h4>
<h5 id="格式说明-1">格式说明</h5>
<p><code>within（类型表达式）</code>：目标对象 target 的类型是否和 within 中指定的类型匹配</p>
<blockquote>
<p>匹配规则： target.getClass().equals(within 表达式中指定的类型）</p>
</blockquote>
<h5 id="举例说明-1">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutWithin</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配 com.crab.spring.aop.demo02 包及其子包下任何类的任何方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;within(com.crab.spring.aop.demo02..*)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配 m.crab.spring.aop.demo02 包及其子包下 IService 类型及其子类型的任何方法</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;within(com.crab.spring.aop.demo02..IService+)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m2</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配 com.crab.spring.aop.demo02.UserService 类中所有方法，不含其子类</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;within(com.crab.spring.aop.demo02.UserService)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m3</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="this">this</h4>
<h5 id="格式说明-2">格式说明</h5>
<p><code>this（类型全限定名）</code>：通过 aop 创建的<strong>代理对象的类型</strong>是否和 this 中指定的类型匹配；this 中使用的表达式必须是类型全限定名，不支持通配符。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">this</span>(x) 的匹配规则是：x.<span style="color:#50fa7b">getClass</span>.<span style="color:#50fa7b">isAssingableFrom</span>(proxy.<span style="color:#50fa7b">getClass</span>)
</span></span></code></pre></div><h5 id="举例说明-2">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.crab.spring.aop.demo02.aspectj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutThis</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">I1</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">C1</span> <span style="color:#8be9fd;font-style:italic">implements</span> I1{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 匹配 I1 类型或是其子类</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;this(com.crab.spring.aop.demo02.aspectj.PointcutThis.I1)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before: &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) {
</span></span><span style="display:flex;"><span>        C1 target <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> C1();
</span></span><span style="display:flex;"><span>        AspectJProxyFactory proxyFactory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AspectJProxyFactory();
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setTarget</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// proxyFactory.setProxyTargetClass(true);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 C1 上所有接口 spring 工具类提供的方法</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;[]</span> allInterfaces <span style="color:#ff79c6">=</span> ClassUtils.<span style="color:#50fa7b">getAllInterfaces</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 设置代理接口</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setInterfaces</span>(allInterfaces);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 添加切面</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">addAspect</span>(PointcutThis.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取代理</span>
</span></span><span style="display:flex;"><span>        I1 proxy <span style="color:#ff79c6">=</span> proxyFactory.<span style="color:#50fa7b">getProxy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 调用方法</span>
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;JDK 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isJdkDynamicProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;CGLIB 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isCglibProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//判断代理对象是否是 C1 类型的</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(C1.<span style="color:#50fa7b">class</span>.<span style="color:#50fa7b">isAssignableFrom</span>(proxy.<span style="color:#50fa7b">getClass</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>来观察下输出</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>before: execution(<span style="color:#ff79c6">void</span> com.crab.spring.aop.demo02.aspectj.PointcutThis$C1.m())
</span></span><span style="display:flex;"><span>C1 m()
</span></span><span style="display:flex;"><span>JDK 代理？<span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>CGLIB 代理？<span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">true</span>
</span></span></code></pre></div><p>使用 JDK 动态代理生成的代理对象，其类型是 I1 类型。</p>
<blockquote>
<p>思考下：将切点表达式改成下面的输出结果是？</p>
<p>// 匹配 C1 类型或是其子类<br>
@Pointcut(&ldquo;this(com.crab.spring.aop.demo02.aspectj.PointcutThis.C1)&rdquo;)<br>
public void pc(){}</p>
</blockquote>
<h4 id="target">target</h4>
<h5 id="格式说明-3">格式说明</h5>
<p><code>target（类型全限定名）</code>：判断<strong>目标对象的类型</strong>是否和指定的类型匹配；表达式必须是类型全限定名，不支持通配符。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>target(x) 匹配规则：x.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">isAssignableFrom</span>(target.<span style="color:#50fa7b">getClass</span>());
</span></span></code></pre></div><h5 id="举例说明-3">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutTarget</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">I1</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">C1</span> <span style="color:#8be9fd;font-style:italic">implements</span> I1{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配目标类型必须是</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;target(com.crab.spring.aop.demo02.aspectj.PointcutTarget.C1)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before: &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) {
</span></span><span style="display:flex;"><span>        C1 target <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> C1();
</span></span><span style="display:flex;"><span>        AspectJProxyFactory proxyFactory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AspectJProxyFactory();
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setTarget</span>(target);
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setProxyTargetClass</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 C1 上所有接口 spring 工具类提供的方法</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;[]</span> allInterfaces <span style="color:#ff79c6">=</span> ClassUtils.<span style="color:#50fa7b">getAllInterfaces</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 设置代理接口</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setInterfaces</span>(allInterfaces);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 添加切面</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">addAspect</span>(PointcutTarget.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取代理</span>
</span></span><span style="display:flex;"><span>        I1 proxy <span style="color:#ff79c6">=</span> proxyFactory.<span style="color:#50fa7b">getProxy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 调用方法</span>
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;JDK 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isJdkDynamicProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;CGLIB 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isCglibProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//判断代理对象是否是 C1 类型的</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(C1.<span style="color:#50fa7b">class</span>.<span style="color:#50fa7b">isAssignableFrom</span>(target.<span style="color:#50fa7b">getClass</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">before</span>: execution(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">PointcutTarget$C1</span>.<span style="color:#50fa7b">m</span>())
</span></span><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m</span>()
</span></span><span style="display:flex;"><span>JDK 代理？<span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>CGLIB 代理？<span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">true</span>
</span></span></code></pre></div><h4 id="args">args</h4>
<h5 id="格式说明-4">格式说明</h5>
<p><code>args（参数类型列表）</code>匹配<strong>当前执行的方法传入的参数</strong>是否为 args 中指定的类型；参数类型列表中的参数必须是<strong>类型全限定名，不支持通配符</strong>；<strong>args 属于动态切入点，也就是执行方法的时候进行判断的，开销非常大，非特殊情况最好不要使用。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>args(String) <span style="color:#6272a4">//    方法个数为 1，类型是 String</span>
</span></span><span style="display:flex;"><span>args(<span style="color:#ff79c6">*</span>,String) <span style="color:#6272a4">//  方法参数个数 2，第 2 个是 String 类型</span>
</span></span><span style="display:flex;"><span>args(..,String) <span style="color:#6272a4">// 方法个数不限制，最后一个必须是 String</span>
</span></span></code></pre></div><h5 id="举例说明-4">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.crab.spring.aop.demo02.aspectj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutArgs</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">I1</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>(Object name);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">C1</span> <span style="color:#8be9fd;font-style:italic">implements</span> I1{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>(Object name) {
</span></span><span style="display:flex;"><span>            String type <span style="color:#ff79c6">=</span> name.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getName</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m() 参数类型 &#34;</span> <span style="color:#ff79c6">+</span> type);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配方法参数个数 1 且类型是必须是 String</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;args(String)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before: &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) {
</span></span><span style="display:flex;"><span>        C1 target <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> C1();
</span></span><span style="display:flex;"><span>        AspectJProxyFactory proxyFactory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AspectJProxyFactory();
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setTarget</span>(target);
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setProxyTargetClass</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 C1 上所有接口 spring 工具类提供的方法</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;[]</span> allInterfaces <span style="color:#ff79c6">=</span> ClassUtils.<span style="color:#50fa7b">getAllInterfaces</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 设置代理接口</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setInterfaces</span>(allInterfaces);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 添加切面</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">addAspect</span>(PointcutArgs.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取代理</span>
</span></span><span style="display:flex;"><span>        I1 proxy <span style="color:#ff79c6">=</span> proxyFactory.<span style="color:#50fa7b">getProxy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 调用方法</span>
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m</span>(<span style="color:#f1fa8c">&#34;xxxx&#34;</span>);
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m</span>(100L);
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;JDK 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isJdkDynamicProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;CGLIB 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isCglibProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//判断代理对象是否是 C1 类型的</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(C1.<span style="color:#50fa7b">class</span>.<span style="color:#50fa7b">isAssignableFrom</span>(target.<span style="color:#50fa7b">getClass</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>观察下输出</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">before</span>: execution(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">PointcutArgs$C1</span>.<span style="color:#50fa7b">m</span>(Object))
</span></span><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m</span>() 参数类型 java.<span style="color:#50fa7b">lang</span>.<span style="color:#50fa7b">String</span>
</span></span><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m</span>() 参数类型 java.<span style="color:#50fa7b">lang</span>.<span style="color:#50fa7b">Long</span>
</span></span><span style="display:flex;"><span>JDK 代理？<span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>CGLIB 代理？<span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">true</span>	
</span></span></code></pre></div><p>参数类型传递是 String 时候增强了，而 Long 的时候没有执行增强方法。</p>
<h4 id="within-1">@within</h4>
<h5 id="格式说明-5">格式说明</h5>
<p><code>@within（注解类型）</code>：匹配指定的注解内定义的方法。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>匹配规则： 被调用的目标方法 Method 对象。getDeclaringClass().<span style="color:#50fa7b">getAnnotation</span>(within 中指定的注解类型） <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>
</span></span></code></pre></div><h5 id="举例说明-5">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.crab.spring.aop.demo02.aspectj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutAnnWithin</span> {
</span></span><span style="display:flex;"><span>    @Retention(RetentionPolicy.<span style="color:#50fa7b">RUNTIME</span>)
</span></span><span style="display:flex;"><span>    @Target(ElementType.<span style="color:#50fa7b">TYPE</span>)
</span></span><span style="display:flex;"><span>    @interface MyAnn {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">I1</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @MyAnn
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">C1</span> <span style="color:#8be9fd;font-style:italic">implements</span> I1 {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配目标类型必须上必须有注解 MyAnn</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;@within(com.crab.spring.aop.demo02.aspectj.PointcutAnnWithin.MyAnn)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before: &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) {
</span></span><span style="display:flex;"><span>        C1 target <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> C1();
</span></span><span style="display:flex;"><span>        AspectJProxyFactory proxyFactory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AspectJProxyFactory();
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setTarget</span>(target);
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setProxyTargetClass</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 C1 上所有接口 spring 工具类提供的方法</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;[]</span> allInterfaces <span style="color:#ff79c6">=</span> ClassUtils.<span style="color:#50fa7b">getAllInterfaces</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 设置代理接口</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setInterfaces</span>(allInterfaces);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 添加切面</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">addAspect</span>(PointcutAnnWithin.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取代理</span>
</span></span><span style="display:flex;"><span>        I1 proxy <span style="color:#ff79c6">=</span> proxyFactory.<span style="color:#50fa7b">getProxy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 调用方法</span>
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;JDK 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isJdkDynamicProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;CGLIB 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isCglibProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//判断代理对象是否是 C1 类型的</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(C1.<span style="color:#50fa7b">class</span>.<span style="color:#50fa7b">isAssignableFrom</span>(target.<span style="color:#50fa7b">getClass</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">before</span>: execution(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">PointcutAnnWithin$C1</span>.<span style="color:#50fa7b">m</span>())
</span></span><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m</span>()
</span></span><span style="display:flex;"><span>JDK 代理？<span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>CGLIB 代理？<span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">true</span>
</span></span></code></pre></div><blockquote>
<p>思考下父类上有注解，子类继承父类的方法，同时考虑下注解@Inherited 是否在切点注解的场景？</p>
</blockquote>
<h4 id="target-1">@target</h4>
<h5 id="格式说明-6">格式说明</h5>
<p><code>@target（注解类型）</code>：判断目标对象 target 类型上是否有指定的注解；@target 中注解类型也必须是全限定类型名。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>匹配规则： target.<span style="color:#50fa7b">class</span>.<span style="color:#50fa7b">getAnnotation</span>（指定的注解类型） <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>
</span></span></code></pre></div><p>注意，如果目标注解是标注在父类上的，那么定义目标注解时候应使用<code>@Inherited</code>标注，使子类能继承父类的注解。</p>
<h5 id="举例说明-6">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.crab.spring.aop.demo02.aspectj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutAnnTarget</span> {
</span></span><span style="display:flex;"><span>    @Retention(RetentionPolicy.<span style="color:#50fa7b">RUNTIME</span>)
</span></span><span style="display:flex;"><span>    @Target(ElementType.<span style="color:#50fa7b">TYPE</span>)
</span></span><span style="display:flex;"><span>    @Inherited <span style="color:#6272a4">// 子类能继承父类的注解</span>
</span></span><span style="display:flex;"><span>    @interface MyAnn2 {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @MyAnn2 <span style="color:#6272a4">// 注解在父类上</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">P1</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>(){}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">C1</span> <span style="color:#8be9fd;font-style:italic">extends</span> P1 {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配目标类型必须上必须有注解 MyAnn</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;@target(com.crab.spring.aop.demo02.aspectj.PointcutAnnTarget.MyAnn2)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before: &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) {
</span></span><span style="display:flex;"><span>        C1 target <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> C1();
</span></span><span style="display:flex;"><span>        AspectJProxyFactory proxyFactory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AspectJProxyFactory();
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setTarget</span>(target);
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setProxyTargetClass</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 C1 上所有接口 spring 工具类提供的方法</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;[]</span> allInterfaces <span style="color:#ff79c6">=</span> ClassUtils.<span style="color:#50fa7b">getAllInterfaces</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 设置代理接口</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setInterfaces</span>(allInterfaces);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 添加切面</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">addAspect</span>(PointcutAnnTarget.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取代理</span>
</span></span><span style="display:flex;"><span>        C1 proxy <span style="color:#ff79c6">=</span> proxyFactory.<span style="color:#50fa7b">getProxy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 调用方法</span>
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;JDK 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isJdkDynamicProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;CGLIB 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isCglibProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 目标类上是否有切点注解</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(target.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getAnnotation</span>(MyAnn2.<span style="color:#50fa7b">class</span>)<span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">before</span>: execution(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">PointcutAnnTarget$C1</span>.<span style="color:#50fa7b">m</span>())
</span></span><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m</span>()
</span></span><span style="display:flex;"><span>JDK 代理？<span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>CGLIB 代理？<span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">true</span>
</span></span></code></pre></div><p>从结果最后一行看，目标对象继承了父类的注解，符合@target 的切点规则。</p>
<h4 id="args-1">@args</h4>
<h5 id="格式说明-7">格式说明</h5>
<p><code>@args（注解类型）</code>：方法参数所属的类上有指定的注解；注意不是参数上有指定的注解，而是参数类型的类上有指定的注解。和<code>args</code>类似，不过针对的是参数类型上的注解。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>匹配规则： 传入的目标位置参数。getClass().<span style="color:#50fa7b">getAnnotation</span>(@args（对应的参数位置的注解类型）)<span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>
</span></span></code></pre></div><h5 id="举例说明-7">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.crab.spring.aop.demo02.aspectj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutAnnArgs</span> {
</span></span><span style="display:flex;"><span>    @Retention(RetentionPolicy.<span style="color:#50fa7b">RUNTIME</span>)
</span></span><span style="display:flex;"><span>    @Target(ElementType.<span style="color:#50fa7b">TYPE</span>)
</span></span><span style="display:flex;"><span>    @Inherited <span style="color:#6272a4">// 子类能继承父类的注解</span>
</span></span><span style="display:flex;"><span>    @interface MyAnn3 {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @MyAnn3
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MyParameter</span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">C1</span>  {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>(MyParameter myParameter) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(myParameter.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getAnnotation</span>(MyAnn3.<span style="color:#50fa7b">class</span>));
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配方法上最后的一个参数类型上有注解 MyAnn3</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;@args(..,com.crab.spring.aop.demo02.aspectj.PointcutAnnArgs.MyAnn3)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before: &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) {
</span></span><span style="display:flex;"><span>        C1 target <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> C1();
</span></span><span style="display:flex;"><span>        AspectJProxyFactory proxyFactory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AspectJProxyFactory();
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setTarget</span>(target);
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setProxyTargetClass</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 C1 上所有接口 spring 工具类提供的方法</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;[]</span> allInterfaces <span style="color:#ff79c6">=</span> ClassUtils.<span style="color:#50fa7b">getAllInterfaces</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 设置代理接口</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setInterfaces</span>(allInterfaces);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 添加切面</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">addAspect</span>(PointcutAnnArgs.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取代理</span>
</span></span><span style="display:flex;"><span>        C1 proxy <span style="color:#ff79c6">=</span> proxyFactory.<span style="color:#50fa7b">getProxy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 调用方法</span>
</span></span><span style="display:flex;"><span>        MyParameter myParameter <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> MyParameter();
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m</span>(myParameter);
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;JDK 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isJdkDynamicProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;CGLIB 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isCglibProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 目标类上是否有切点注解</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(myParameter.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getAnnotation</span>(MyAnn3.<span style="color:#50fa7b">class</span>)<span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>观察结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">before</span>: execution(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">PointcutAnnArgs$C1</span>.<span style="color:#50fa7b">m</span>(MyParameter))
</span></span><span style="display:flex;"><span>@com.crab.spring.aop.demo02.aspectj.PointcutAnnArgs$MyAnn3()
</span></span><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m</span>()
</span></span><span style="display:flex;"><span>JDK 代理？<span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>CGLIB 代理？<span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">true</span>
</span></span></code></pre></div><p>第二行中目标方法上输出了参数的注解。</p>
<p>最后一行判断参数类型上确实有注解。</p>
<h4 id="annotation">@annotation</h4>
<h5 id="格式说明-8">格式说明</h5>
<p><code>@annotation（注解类型）</code>：匹配被调用的目标对象的方法上有指定的注解</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>匹配规则：target.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getMethod</span>(<span style="color:#f1fa8c">&#34;目标方法名&#34;</span>).<span style="color:#50fa7b">getDeclaredAnnotation</span>(@annotation（目标注解）)<span style="color:#ff79c6">!=</span><span style="color:#ff79c6">null</span>
</span></span></code></pre></div><p>这个在针对特定注解的方法日志拦截场景下应用比较多。</p>
<h5 id="举例说明-8">举例说明</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.crab.spring.aop.demo02.aspectj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutAnnotation</span> {
</span></span><span style="display:flex;"><span>    @Retention(RetentionPolicy.<span style="color:#50fa7b">RUNTIME</span>)
</span></span><span style="display:flex;"><span>    @Target(ElementType.<span style="color:#50fa7b">METHOD</span>)
</span></span><span style="display:flex;"><span>    @interface MyAnn4 {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 父类 方法上都有@MyAnn4
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">P1</span>{
</span></span><span style="display:flex;"><span>        @MyAnn4
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m1</span>(){
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;P1 m()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        @MyAnn4
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m2</span>(){
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;P1 m2()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 子类
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 注意重新重写了父类的 m1 方法但是没有声明注解@Ann4
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 新增了 m3 方法带注解@Ann4
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">C1</span> <span style="color:#8be9fd;font-style:italic">extends</span> P1 {
</span></span><span style="display:flex;"><span>        @Override
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m1</span>() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m1()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        @MyAnn4
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m3</span>() {
</span></span><span style="display:flex;"><span>            System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;C1 m3()&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 匹配调用的方法上必须有注解</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;@annotation(com.crab.spring.aop.demo02.aspectj.PointcutAnnotation.MyAnn4)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before: &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) <span style="color:#8be9fd;font-style:italic">throws</span> NoSuchMethodException {
</span></span><span style="display:flex;"><span>        C1 target <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> C1();
</span></span><span style="display:flex;"><span>        AspectJProxyFactory proxyFactory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AspectJProxyFactory();
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setTarget</span>(target);
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setProxyTargetClass</span>(<span style="color:#ff79c6">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 C1 上所有接口 spring 工具类提供的方法</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;[]</span> allInterfaces <span style="color:#ff79c6">=</span> ClassUtils.<span style="color:#50fa7b">getAllInterfaces</span>(target);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 设置代理接口</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">setInterfaces</span>(allInterfaces);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 添加切面</span>
</span></span><span style="display:flex;"><span>        proxyFactory.<span style="color:#50fa7b">addAspect</span>(PointcutAnnotation.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取代理</span>
</span></span><span style="display:flex;"><span>        C1 proxy <span style="color:#ff79c6">=</span> proxyFactory.<span style="color:#50fa7b">getProxy</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 调用方法</span>
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m1</span>();
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m2</span>();
</span></span><span style="display:flex;"><span>        proxy.<span style="color:#50fa7b">m3</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;JDK 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isJdkDynamicProxy</span>(proxy));
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;CGLIB 代理？&#34;</span> <span style="color:#ff79c6">+</span> AopUtils.<span style="color:#50fa7b">isCglibProxy</span>(proxy));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 目标对象的目标方法上是否直接声明了注解 MyAnn4</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(target.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getMethod</span>(<span style="color:#f1fa8c">&#34;m1&#34;</span>).<span style="color:#50fa7b">getDeclaredAnnotation</span>(MyAnn4.<span style="color:#50fa7b">class</span>)<span style="color:#ff79c6">!=</span><span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(target.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getMethod</span>(<span style="color:#f1fa8c">&#34;m2&#34;</span>).<span style="color:#50fa7b">getDeclaredAnnotation</span>(MyAnn4.<span style="color:#50fa7b">class</span>)<span style="color:#ff79c6">!=</span><span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(target.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getMethod</span>(<span style="color:#f1fa8c">&#34;m3&#34;</span>).<span style="color:#50fa7b">getDeclaredAnnotation</span>(MyAnn4.<span style="color:#50fa7b">class</span>)<span style="color:#ff79c6">!=</span><span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>观察下结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m1</span>()
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">before</span>: execution(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">PointcutAnnotation$P1</span>.<span style="color:#50fa7b">m2</span>())
</span></span><span style="display:flex;"><span>P1 <span style="color:#50fa7b">m2</span>()
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">before</span>: execution(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">PointcutAnnotation$C1</span>.<span style="color:#50fa7b">m3</span>())
</span></span><span style="display:flex;"><span>C1 <span style="color:#50fa7b">m3</span>()
</span></span><span style="display:flex;"><span>JDK 代理？<span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span>CGLIB 代理？<span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">false</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">true</span>
</span></span></code></pre></div><p>简单分析下：</p>
<ol>
<li>C1 中重写了 m1 方法，上面有没有 @Ann4，所有方法没有被拦截</li>
<li>其它的 m2 在父类上有注解@Ann4，m3 在子类上也有注解@Ann4，所以拦截了。</li>
<li>最后 3 行输出了目标对象的 3 个方法上是否有注解的情况。</li>
</ol>
<h4 id="bean">bean</h4>
<h5 id="格式说明-9">格式说明</h5>
<p><strong>bean(bean 名称）</strong>：这个用在 spring 环境中，匹配容器中指定名称的 bean。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>匹配格式：ApplicationContext.<span style="color:#50fa7b">getBean</span>(<span style="color:#f1fa8c">&#34;bean 表达式中指定的 bean 名称&#34;</span>) <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>
</span></span></code></pre></div><h5 id="举例说明-9">举例说明</h5>
<p>定义一个 bean</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.crab.spring.aop.demo02.aspectj;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MyBean</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String beanName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">MyBean</span>(String beanName) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">beanName</span> <span style="color:#ff79c6">=</span> beanName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;我是&#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">beanName</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>切面中的切点和通知定义</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutBean</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 容器中 bean 名称是&#34;myBean1&#34;的方法进行拦截</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;bean(myBean1)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">pc</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;pc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">m</span>(JoinPoint joinPoint) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;start &#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>组合使用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@EnableAspectJAutoProxy <span style="color:#6272a4">// 自动生成代理对象</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PointcutBeanConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 注入 myBean1</span>
</span></span><span style="display:flex;"><span>    @Bean(<span style="color:#f1fa8c">&#34;myBean1&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> MyBean <span style="color:#50fa7b">myBean1</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> MyBean(<span style="color:#f1fa8c">&#34;myBean1&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">//  myBean2</span>
</span></span><span style="display:flex;"><span>    @Bean(<span style="color:#f1fa8c">&#34;myBean2&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> MyBean <span style="color:#50fa7b">myBean2</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> MyBean(<span style="color:#f1fa8c">&#34;myBean2&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// 注入切面</span>
</span></span><span style="display:flex;"><span>    @Bean(<span style="color:#f1fa8c">&#34;pointcutBean&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> PointcutBean <span style="color:#50fa7b">pointcutBean</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> PointcutBean();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) {
</span></span><span style="display:flex;"><span>        AnnotationConfigApplicationContext context <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">new</span> AnnotationConfigApplicationContext(PointcutBeanConfig.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        MyBean myBean1 <span style="color:#ff79c6">=</span> context.<span style="color:#50fa7b">getBean</span>(<span style="color:#f1fa8c">&#34;myBean1&#34;</span>, MyBean.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        myBean1.<span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>        MyBean myBean2 <span style="color:#ff79c6">=</span> context.<span style="color:#50fa7b">getBean</span>(<span style="color:#f1fa8c">&#34;myBean2&#34;</span>, MyBean.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        myBean2.<span style="color:#50fa7b">m</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>观察下结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>start <span style="color:#50fa7b">execution</span>(<span style="color:#8be9fd">void</span> com.<span style="color:#50fa7b">crab</span>.<span style="color:#50fa7b">spring</span>.<span style="color:#50fa7b">aop</span>.<span style="color:#50fa7b">demo02</span>.<span style="color:#50fa7b">aspectj</span>.<span style="color:#50fa7b">MyBean</span>.<span style="color:#50fa7b">m</span>())
</span></span><span style="display:flex;"><span>我是 myBean1
</span></span><span style="display:flex;"><span>我是 myBean2
</span></span></code></pre></div><p>myBean1 的方法被拦截了。</p>
<p>上面介绍了 Spring 中 10 中切点表达式，下面介绍下切点的组合使用和公共切点的抽取。</p>
<h3 id="切点的组合">切点的组合</h3>
<p>切点与切点直接支持逻辑逻辑组合操作： <code>&amp;&amp;</code> 、<code>||、</code> <code>!</code>。使用较小的命名组件构建更复杂的切入点表达式是最佳实践。</p>
<h5 id="同一个类内切点组合">同一个类内切点组合</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CombiningPointcut</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 匹配 com.crab.spring.aop.demo02 包及子包下任何类的 public 方法
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(public * com.crab.spring.aop.demo02..*.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">publicMethodPc</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * com.crab.spring.aop.demo02.UserService 类的所有方法
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop.demo02.UserService.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">serviceMethodPc</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 组合的切点
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;publicMethodPc() &amp;&amp; serviceMethodPc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">combiningPc</span>(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 组合的切点 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;publicMethodPc() || !serviceMethodPc()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">combiningPc2</span>(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="不同类之间切点组合">不同类之间切点组合</h5>
<p>切点方法的可见性会影响组合但是不影响切点的匹配。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CombiningPointcut2</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * com.crab.spring.aop.demo02.UserService 类的所有方法
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.crab.spring.aop.demo02.UserService.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">serviceMethodPc2</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 组合的切点，跨类组合
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;com.crab.spring.aop.demo02.aspectj.reuse.CombiningPointcut.publicMethodPc() &amp;&amp; serviceMethodPc2()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">combiningPc</span>(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 组合的切点，跨类组合，由于 serviceMethodPc 是 private, 此处无法组合
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;com.crab.spring.aop.demo02.aspectj.reuse.CombiningPointcut.serviceMethodPc() &amp;&amp; serviceMethodPc2()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">combiningPc2</span>(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="切点的公用">切点的公用</h3>
<p>在使用企业应用程序时，开发人员通常希望从多个方面引用应用程序的模块和特定的操作集。建议为此目的定义一个捕获公共切入点表达式的 CommonPointcuts 方面。直接看案例。</p>
<p>不同层的公共切点</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"> * 公用的切点
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">CommonPointcuts</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * web 层的通用切点
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;within(com.xyz.myapp.web..*)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">inWebLayer</span>() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;within(com.xyz.myapp.service..*)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">inServiceLayer</span>() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;within(com.xyz.myapp.dao..*)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">inDataAccessLayer</span>() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.xyz.myapp..service.*.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">businessService</span>() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* com.xyz.myapp.dao.*.*(..))&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">dataAccessOperation</span>() {}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>程序中可以直接引用这些公共的切点</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">UseCommonPointcuts</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 直接使用公共切点
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;com.crab.spring.aop.demo02.aspectj.reuse.CommonPointcuts.inWebLayer()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">before</span>(JoinPoint joinPoint){
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;before:&#34;</span> <span style="color:#ff79c6">+</span> joinPoint);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="带参数的切点">带参数的切点</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RunWith(SpringJUnit4ClassRunner.<span style="color:#50fa7b">class</span>)
</span></span><span style="display:flex;"><span>@ContextConfiguration(classes <span style="color:#ff79c6">=</span> AspectConfig.<span style="color:#50fa7b">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">AspectDemo</span> {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> List<span style="color:#ff79c6">&lt;</span>Perform<span style="color:#ff79c6">&gt;</span> performList;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testPerform</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (Perform perform : performList) {
</span></span><span style="display:flex;"><span>            perform.<span style="color:#50fa7b">doPerform</span>(<span style="color:#f1fa8c">&#34;dc1&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@EnableAspectJAutoProxy
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">AspectConfig</span> {
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Audience <span style="color:#50fa7b">audience</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> Audience();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Aspect
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Audience</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 声明一个切点
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* io2.dc.Perform.doPerform(..)) &amp;&amp; bean(poet)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">perform</span>(){};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 声明一个可以接收参数的切点
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * @param name
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Pointcut(<span style="color:#f1fa8c">&#34;execution(* io2.dc.Perform.doPerform(String)) &amp;&amp; args(name)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">performWithArg</span>(String name){};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;perform()&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">drinkWater</span>() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(<span style="color:#f1fa8c">&#34;喝口水&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Before(<span style="color:#f1fa8c">&#34;performWithArg(name)&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">printName</span>(String name) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>((name <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;开始表演了&#34;</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">Perform</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">doPerform</span>(String name);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Poet</span> <span style="color:#8be9fd;font-style:italic">implements</span> Perform {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">doPerform</span>(String name) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>((<span style="color:#f1fa8c">&#34;朗诵&#34;</span> <span style="color:#ff79c6">+</span> name));
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> 0;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Singer</span> <span style="color:#8be9fd;font-style:italic">implements</span> Perform {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">doPerform</span>(String name) {
</span></span><span style="display:flex;"><span>        System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>((<span style="color:#f1fa8c">&#34;歌唱家&#34;</span> <span style="color:#ff79c6">+</span> name));
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> 0;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>参考资料</p>
<ul>
<li><a href="https://www.cnblogs.com/kongbubihai/p/16017046.html">https://www.cnblogs.com/kongbubihai/p/16017046.html</a></li>
<li>《Spring 实战第4版》</li>
</ul>

        </div>

        

        


        
        <footer class="article-footer">
            <ul class="article-tag-list">
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="https://dccmmtop.github.io/%20tags/spring">spring
                    </a>
                </li>
                
            </ul>
        </footer>
        
    </div>
    
<nav id="article-nav">
    
    <a href="../../posts/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%A4%87%E5%BF%98/" id="article-nav-newer" class="article-nav-link-wrap">
        <div class="article-nav-title"><span>&lt;</span>&nbsp;
            常用工具备忘
        </div>
    </a>
    
    
    <a href="../../posts/%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%9A%84spring/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">面向切面的Spring&nbsp;<span>&gt;</span></div>
    </a>
    
</nav>


</article>
            
        </section>

        <div>
            

            <script src="https://utteranc.es/client.js" repo="dccmmtop/dccmmtop.github.io" issue-term="pathname"
                label="Comment" theme="github-light" crossorigin="anonymous" async>
                </script>
            

        </div>

        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2025 dc
            <br />
            Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with theme <a
                href="https://github.com/carsonip/hugo-theme-minos" target="_blank">Minos</a>


        </div>
    </div>
    

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css"
        integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"
        integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <script>
        document.getElementById('main-nav-toggle').addEventListener('click', function () {
            var header = document.getElementById('header');
            if (header.classList.contains('mobile-on')) {
                header.classList.remove('mobile-on');
            } else {
                header.classList.add('mobile-on');
            }
        });
    </script>
    <style>
        #footer-info {
            line-height: 1.4em;
            font-size: 10px;
        }

        .custom-blog-info {
            font-family: 'Long Cang', cursive;
            border-top: 1px dashed #333;
            font-size: 16px;
            margin-top: 10px;
            padding-top: 10px;
            line-height: 1.4em;
        }
    </style>
</footer>

    </div>
</body>

</html>